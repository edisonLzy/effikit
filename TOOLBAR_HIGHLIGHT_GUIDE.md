# Chrome 工具栏高亮功能测试指南

## 功能概述

EffiKit 扩展现在在 Chrome 工具栏中提供了高亮功能的状态显示和控制，通过扩展图标的徽章和标题来指示当前页面的高亮状态。

## 工具栏状态指示

### 1. 扩展图标徽章
- **无徽章**：当前页面没有高亮内容
- **橙色圆点 (●)**：当前页面有高亮内容且功能已启用
- **灰色圆点 (●)**：当前页面有高亮内容但功能已禁用

### 2. 鼠标悬停标题
- **"EffiKit - 开发工具集成平台 (高亮已启用)"**：功能已启用，无高亮内容
- **"EffiKit - 开发工具集成平台 (高亮已禁用)"**：功能已禁用，无高亮内容
- **"EffiKit - 开发工具集成平台 (高亮已启用，当前页面有高亮内容)"**：功能已启用，有高亮内容
- **"EffiKit - 开发工具集成平台 (高亮已禁用，当前页面有高亮内容)"**：功能已禁用，有高亮内容

## 测试步骤

### 步骤 1：安装和加载扩展
1. 在 Chrome 中打开 `chrome://extensions/`
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择项目的 `dist` 目录
5. 确保扩展已启用并出现在工具栏中

### 步骤 2：测试基本功能开关
1. 打开任意网页（如 Google.com）
2. 观察扩展图标：应该没有徽章
3. 将鼠标悬停在图标上：应显示"高亮已启用"
4. 点击扩展图标：功能应切换到禁用状态
5. 再次悬停：应显示"高亮已禁用"
6. 再次点击：功能应重新启用

### 步骤 3：测试高亮内容检测
1. 确保高亮功能已启用
2. 在页面上选择一段文本
3. 选择一个颜色进行高亮
4. 观察扩展图标：应出现橙色圆点徽章
5. 悬停图标：应显示"当前页面有高亮内容"

### 步骤 4：测试功能禁用状态
1. 在有高亮内容的页面上点击扩展图标
2. 高亮功能应被禁用
3. 扩展图标徽章应变为灰色圆点
4. 悬停应显示"高亮已禁用，当前页面有高亮内容"
5. 页面上的高亮应该隐藏（如果实现了显示/隐藏功能）

### 步骤 5：测试跨标签页状态
1. 打开多个标签页
2. 在其中一个标签页创建高亮
3. 切换到其他标签页
4. 观察扩展图标状态应该根据当前标签页的高亮内容正确显示
5. 在不同标签页中切换高亮功能开关
6. 验证每个标签页的状态独立管理

### 步骤 6：测试页面刷新
1. 在有高亮内容的页面上刷新页面
2. 页面加载完成后，扩展图标应正确显示徽章
3. 高亮内容应重新显示在页面上

### 步骤 7：测试高亮删除
1. 在侧边栏的"高亮管理"工具中删除一些高亮
2. 如果删除了页面的所有高亮，扩展图标徽章应消失
3. 如果还有剩余高亮，徽章应保持显示

## 预期行为

### 正常情况
- ✅ 图标徽章正确反映页面高亮状态
- ✅ 标题提示信息准确
- ✅ 点击图标能正确切换功能状态
- ✅ 跨标签页状态独立管理
- ✅ 页面刷新后状态正确恢复

### 边界情况
- ✅ 页面加载过程中状态正确处理
- ✅ 网络错误时不影响基本功能
- ✅ 快速切换标签页时状态正确更新
- ✅ 扩展重新加载后状态正确恢复

## 故障排除

### 图标状态不更新
1. 检查浏览器控制台是否有错误信息
2. 确认 content script 已正确加载
3. 验证 background script 的消息监听是否正常

### 跨标签页状态混乱
1. 检查标签页 ID 是否正确传递
2. 确认状态映射表 (`tabHighlightStatus`) 正常工作
3. 验证标签页切换事件监听是否正确

### 徽章显示异常
1. 确认 `chrome.action.setBadgeText` API 调用正常
2. 检查徽章颜色设置是否正确
3. 验证徽章文本内容是否符合预期

## 开发者工具调试

### Background Script 调试
1. 打开 `chrome://extensions/`
2. 找到 EffiKit 扩展，点击"背景页"或"Service Worker"
3. 在控制台中查看相关日志：
   - `Highlight toggled for tab X: true/false`
   - 消息传递日志
   - 错误信息

### Content Script 调试
1. 在任意网页上按 F12 打开开发者工具
2. 在控制台中查看：
   - `EffiKit content script loaded`
   - `Highlighter initialized`
   - 高亮创建/删除日志

## 已知限制

1. **页面加载延迟**：页面加载完成后可能需要 1-2 秒才能正确显示状态
2. **特殊页面**：某些特殊页面（如 chrome:// 页面）可能无法使用高亮功能
3. **性能考虑**：大量高亮内容可能影响页面渲染性能

## 后续改进

- [ ] 添加更多状态指示（如高亮数量）
- [ ] 支持快捷键切换功能
- [ ] 添加右键菜单选项
- [ ] 优化状态更新性能
- [ ] 支持自定义徽章样式 